<!-- 
    Copyright 2014-2015 Travel Modelling Group, Department of Civil Engineering, University of Toronto

    This file is part of XTMF.

    XTMF is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    XTMF is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with XTMF.  If not, see <http://www.gnu.org/licenses/>.
-->
<UserControl x:Class="XTMF.Gui.UserControls.ModelSystemDisplay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:xtmf="clr-namespace:XTMF;assembly=XTMF"
             xmlns:my="clr-namespace:XTMF.Gui"
             xmlns:this="clr-namespace:XTMF.Gui.UserControls"
             KeyboardNavigation.IsTabStop="True"
             FocusManager.FocusedElement="{Binding ElementName=FilterBox}"
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition MinWidth="200px" Width="*"/>
            <ColumnDefinition Width="AUTO"/>
            <ColumnDefinition MinWidth="200px" Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid Grid.Column="0" Background="{StaticResource ControlBackgroundBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="AUTO" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <my:FilterBox x:Name="FilterBox" UseItemSourceFilter="False" FilterWatermark="Search... (Ctrl+E)" />
            <TreeView Grid.Row="1" Background="{StaticResource ControlBackgroundBrush}" 
                  x:Name="ModuleDisplay" ItemsSource="{Binding DisplayRoot}" SelectedItemChanged="ModuleDisplay_SelectedItemChanged"
                      KeyboardNavigation.TabNavigation="Cycle" KeyboardNavigation.DirectionalNavigation="Cycle">
                <TreeView.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Rename">
                            <MenuItem.Icon>
                                <Image>
                                    <Image.Source>
                                        <BitmapImage UriSource="pack://application:,,,/XTMF.Gui;component/Resources/base_cog_32.png" />
                                    </Image.Source>
                                </Image>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Module" Click="Module_Clicked" />
                        <MenuItem Header="Remove" Click="Remove_Clicked">
                            <MenuItem.Icon>
                                <Image>
                                    <Image.Source>
                                        <BitmapImage UriSource="pack://application:,,,/XTMF.Gui;component/Images/delete.png" />
                                    </Image.Source>
                                </Image>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Help" Click="Help_Clicked">
                            <MenuItem.Icon>
                                <Image>
                                    <Image.Source>
                                        <BitmapImage UriSource="pack://application:,,,/XTMF.Gui;component/Resources/help.png" />
                                    </Image.Source>
                                </Image>
                            </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>
                </TreeView.ContextMenu>
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate DataType="{x:Type xtmf:ModelSystemStructureModel}" ItemsSource="{Binding Path=Children}">
                        <my:BorderIconButton Icon="/XTMF.Gui;component/Resources/Settings.png" 
                                     Header="{Binding Name}"
                                     Text="{Binding Description}"
                                     ShadowColour="{StaticResource ControlHeaderColour}"
                                     HighlightColour="Green"
                                     ContextMenu="{Binding RelativeSource={RelativeSource Mode=FindAncestor,
                                                    AncestorType=TreeView}, Path=ContextMenu}"
                                    Margin="0"
                                    KeyboardNavigation.TabNavigation="Continue"
                                    KeyboardNavigation.IsTabStop="false" IsTabStop="False" Width="275" Focusable="False" x:Name="DisplayButton">
                        </my:BorderIconButton>
                        <HierarchicalDataTemplate.Triggers>
                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=TreeViewItem}}" Value="True">
                                <Setter TargetName="DisplayButton" Property="ShadowColour" Value="{StaticResource ResourceKey=FocusColour}" />
                            </DataTrigger>
                        </HierarchicalDataTemplate.Triggers>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
                <TreeView.ItemContainerStyle>
                    <Style TargetType="TreeViewItem" >
                        <Style.Resources>
                            <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="{StaticResource SelectionBlue}"/>
                            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="{StaticResource SelectionBlue}"/>
                        </Style.Resources>
                        <Setter Property="KeyboardNavigation.TabNavigation" Value="Once" />
                        <Setter Property="KeyboardNavigation.IsTabStop" Value="True" />
                        <Setter Property="Focusable" Value="True" />
                        <Setter Property="BorderThickness" Value="0" />
                        <Setter Property="Background" Value="Transparent" />
                        <EventSetter Event="TreeViewItem.Expanded" Handler="OnTreeExpanded" />
                    </Style>
                </TreeView.ItemContainerStyle>
            </TreeView>
        </Grid>
        <GridSplitter Grid.Column="1" Width="4" HorizontalAlignment="Center" VerticalAlignment="Stretch" IsTabStop="False" Background="White" ShowsPreview="True" />
        <Grid Grid.Column="2" HorizontalAlignment="Stretch" Background="{StaticResource ControlBackgroundBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="AUTO" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <my:FilterBox Grid.Row="0" x:Name="ParameterFilterBox" FilterWatermark="Search... (Ctrl+P)" />
            <ListView Grid.Row="1" x:Name="ParameterDisplay" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" HorizontalContentAlignment="Stretch" Padding="0" BorderThickness="0" 
                      Margin="0" Background="{StaticResource ControlBackgroundBrush}" KeyboardNavigation.TabNavigation="Cycle">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border BorderThickness="1" BorderBrush="#999999" HorizontalAlignment="Stretch">
                            <StackPanel Orientation="Vertical" HorizontalAlignment="Stretch"
                                    x:Name="ParameterBorder" GotKeyboardFocus="ParameterBorder_GotFocus" LostKeyboardFocus="ParameterBorder_LostFocus"
                            MouseLeave="ParameterBorder_MouseLeave" MouseEnter="ParameterBorder_MouseEnter">
                                <StackPanel.Background>
                                    <SolidColorBrush Color="{StaticResource ResourceKey=ControlBackgroundColour}" />
                                </StackPanel.Background>
                                <Expander Margin="0.2cm,5,0.2cm,5" Foreground="White" FontSize="14"
                                  HorizontalAlignment="Stretch" ToolTip="{Binding ToolTipText, Mode=OneTime}" Style="{StaticResource ParameterNameStyle}">
                                    <Expander.Header>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="AUTO"/>
                                                <ColumnDefinition Width="AUTO"/>
                                                <ColumnDefinition Width="AUTO"/>
                                                <ColumnDefinition Width="AUTO"/>
                                            </Grid.ColumnDefinitions>
                                            <CheckBox Grid.Column="0" Width="16" Margin="0,0,0,0" Height="16" VerticalAlignment="Center" IsChecked="{Binding TempQuick}" ToolTip="Quick Parameter"
                                                  Checked="CheckBox_Checked" Unchecked="CheckBox_Checked" IsTabStop="False" />
                                            <TextBlock Grid.Column="1" Margin="2" Text="{Binding Name, Mode=OneTime}" Foreground="Black" TextTrimming="CharacterEllipsis" Cursor="Hand" />
                                            <Image Grid.Column="2" Margin="2" VerticalAlignment="Center" HorizontalAlignment="Center" Source="/XTMF.Gui;component/Resources/Links.png" 
                                               ToolTip="{Binding LinkedParameter}" Visibility="{Binding LinkedParameterVisibility}" />
                                            <Image Grid.Column="3" Margin="2" VerticalAlignment="Center" HorizontalAlignment="Center" Source="/XTMF.Gui;component/Resources/Lock.png" 
                                               ToolTip="System Parameter" Visibility="{Binding SystemParameterVisibility, Mode=OneTime}" />
                                        </Grid>
                                    </Expander.Header>
                                    <TextBlock HorizontalAlignment="Left" Foreground="Black" FontWeight="Normal"
                                       FontSize="11" TextWrapping="Wrap" Text="{Binding Description, Mode=OneTime}" />
                                </Expander>
                                <TextBox  Margin="0.2cm,5,0.2cm,5" HorizontalAlignment="Stretch" Text="{Binding Value, NotifyOnSourceUpdated=True, Mode=OneWay}" SourceUpdated="TextBox_SourceUpdated"
                                             PreviewKeyDown="HintedTextBox_PreviewKeyDown"  LostFocus="TextBox_LostFocus" GotFocus="TextBox_GotFocus" Foreground="Black" FontSize="14"
                                         SelectionBrush="#0F6FC6" SelectionOpacity="0.4" BorderThickness="0" Height="20" Padding="10">
                                    <TextBox.Background>
                                        <SolidColorBrush Color="#EEEEEE" />
                                    </TextBox.Background>
                                    <TextBox.CaretBrush>
                                        <SolidColorBrush Color="Black" />
                                    </TextBox.CaretBrush>
                                </TextBox>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="KeyboardNavigation.IsTabStop" Value="False" />
                        <Setter Property="BorderThickness" Value="0" />
                        <Style.Resources>
                            <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="Transparent"/>
                            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="Transparent"/>
                        </Style.Resources>
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>
        </Grid>
    </Grid>
</UserControl>
